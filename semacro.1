.\" semacro.1 -- man page for semacro
.TH SEMACRO 1 "2026-02-27" "semacro 0.2.0" "SELinux Policy Tools"
.SH NAME
semacro \- explore and expand SELinux policy macros, interfaces, and templates
.SH SYNOPSIS
.B semacro
.RB [ \-\-no\-color ]
.RB [ \-\-include\-path
.IR DIR ]
.I command
.RI [ options ]
.SH DESCRIPTION
.B semacro
parses the SELinux reference\-policy macro library and provides quick
lookup, search, and recursive expansion of interfaces, templates, and
defines.
It reads
.B .if
and
.B .spt
files from the policy include tree and builds an in\-memory index.
.PP
Unlike the raw M4 source, semacro can substitute arguments into macro
bodies, recursively expand nested calls into a tree of final policy
rules, and output flat copy\-paste\-ready rules for use in
.B .te
policy files.
.SH GLOBAL OPTIONS
.TP
.B \-\-no\-color
Disable colored output.
Color is also disabled automatically when stdout is not a terminal.
.TP
.BI \-\-include\-path " DIR"
Path to the SELinux policy include directory.
Overrides the
.B SEMACRO_INCLUDE_PATH
environment variable and auto\-detection.
.TP
.BR \-V ", " \-\-version
Print the version and exit.
.TP
.BR \-h ", " \-\-help
Print usage information and exit.
.SH COMMANDS
.SS lookup \fINAME\fR
Show the definition of a macro.
.I NAME
may be a bare macro name (e.g.\&
.BR files_pid_filetrans )
or a full call with arguments (e.g.\&
.BR "\(dqfiles_pid_filetrans(ntpd_t, ntpd_var_run_t, file)\(dq" ).
When arguments are supplied, positional parameters
.RB ( $1 ", " $2 ", \&...")
are substituted into the body.
.PP
Options:
.TP
.BR \-e ", " \-\-expand
Recursively expand nested macro calls into a tree of final policy
rules.
Permission\-set defines
.RB ( search_dir_perms ", " read_file_perms ", " etc.)
are resolved inline.
Mutually exclusive with
.BR \-r .
.TP
.BR \-r ", " \-\-rules
Output flat, deduplicated policy rules suitable for pasting directly
into a
.B .te
file.
Access\-vector rules with the same source, target, and class are merged.
Mutually exclusive with
.BR \-e .
.TP
.BI \-d " N" "\fR, " \-\-depth " N"
Limit expansion depth (default: 10).
.PP
For both
.B lookup
and
.BR find ,
the positional argument can be read from stdin when piped:
.PP
.RS 4
.EX
echo "files_pid_filetrans(ntpd_t, ntpd_var_run_t, file)" | semacro lookup \-r
.EE
.RE
.SS find \fIPATTERN\fR
Search for macros whose name matches the Python regular expression
.IR PATTERN .
.SS list
List all indexed macros.
.TP
.BR \-c " \fICATEGORY\fR, " \-\-category " \fICATEGORY\fR"
Filter by policy category.
Valid values:
.BR kernel ", " system ", " admin ", " apps ", " roles ", "
.BR services ", " contrib ", " distributed ", " support ", " all
(default:
.BR all ).
.SS callers \fINAME\fR
Find which macros directly call the given macro (reverse lookup).
Useful for understanding the impact of changing a macro definition.
.SS which \fISOURCE TARGET PERMISSION\fR
Find macros that would grant the requested access.
Expands candidate macros with trial arguments and checks the resulting
rules for a match.
.PP
Options:
.TP
.BR \-T ", " \-\-transition
Search for
.B type_transition
rules instead of allow rules.
In this mode, the three positional arguments are
.IR SOURCE ", " PARENT_TYPE ", " NEW_TYPE .
.TP
.BI \-C " CLASS" "\fR, " \-\-class " CLASS"
Filter by object class (e.g.\&
.BR file ", " dir ", " sock_file ).
.TP
.BI \-N " FILENAME" "\fR, " \-\-name " FILENAME"
Filter by named transition filename (only with
.BR \-T ).
.SS telookup \fIFILEPATH\fR
Read a
.B .te
file, expand every macro call, and output the full set of final
policy rules (flat, deduplicated, merged).
Use
.B \-
to read from stdin.
.PP
Options:
.TP
.BI \-d " N" "\fR, " \-\-depth " N"
Limit expansion depth (default: 10).
.TP
.BR \-t ", " \-\-tree
Output expansion trees for each macro call instead of flat rules.
.SS deps \fINAME\fR
Walk the call tree of a macro and output a dependency graph.
Defaults to DOT (Graphviz) format; use
.B \-\-mermaid
for Mermaid format.
.PP
Options:
.TP
.BR \-m ", " \-\-mermaid
Output Mermaid format instead of DOT.
.TP
.BI \-d " N" "\fR, " \-\-depth " N"
Max depth to follow calls (default: 10).
.PP
To render DOT output to an image, pipe to
.BR dot (1)
(from
.BR graphviz ):
.PP
.RS 4
.EX
semacro deps files_pid_filetrans | dot \-Tpng \-o graph.png
.EE
.RE
.SS init \fINAME\fR
Generate starter
.BR .te ", " .if ", and " .fc
files for a new confined daemon.
Creates standard type declarations, logging, and PID file handling.
.PP
Options:
.TP
.BI \-o " DIR" "\fR, " \-\-output\-dir " DIR"
Directory to create files in (default: current directory).
.SH EXAMPLES
Look up a macro definition:
.PP
.RS 4
.EX
semacro lookup files_pid_filetrans
.EE
.RE
.PP
Substitute arguments:
.PP
.RS 4
.EX
semacro lookup "files_pid_filetrans(ntpd_t, ntpd_var_run_t, file)"
.EE
.RE
.PP
Expand into a full policy rule tree:
.PP
.RS 4
.EX
semacro lookup \-e "files_pid_filetrans(ntpd_t, ntpd_var_run_t, file)"
.EE
.RE
.PP
Get flat rules for pasting into a \fB.te\fR file:
.PP
.RS 4
.EX
semacro lookup \-r "apache_read_log(mysqld_t)"
.EE
.RE
.PP
Search for macros matching a pattern:
.PP
.RS 4
.EX
semacro find "pid_filetrans"
.EE
.RE
.PP
List macros in the kernel category:
.PP
.RS 4
.EX
semacro list \-c kernel
.EE
.RE
.PP
Find which macros call filetrans_pattern:
.PP
.RS 4
.EX
semacro callers filetrans_pattern
.EE
.RE
.PP
Find macros granting ntpd_t read access to httpd_log_t:
.PP
.RS 4
.EX
semacro which ntpd_t httpd_log_t read
.EE
.RE
.PP
Find macros creating a type_transition under var_run_t:
.PP
.RS 4
.EX
semacro which \-T ntpd_t var_run_t ntpd_var_run_t
.EE
.RE
.PP
Expand all macros in a policy module:
.PP
.RS 4
.EX
semacro telookup myapp.te
.EE
.RE
.PP
Output a dependency graph in DOT format:
.PP
.RS 4
.EX
semacro deps files_pid_filetrans | dot \-Tpng \-o graph.png
.EE
.RE
.PP
Generate a policy skeleton for a new daemon:
.PP
.RS 4
.EX
semacro init myapp
.EE
.RE
.SH ENVIRONMENT
.TP
.B SEMACRO_INCLUDE_PATH
Path to the SELinux reference\-policy include directory.
If not set, semacro tries
.I /usr/share/selinux/devel/include
(from
.BR selinux\-policy\-devel ).
.SH FILES
.TP
.I /usr/share/selinux/devel/include/
Default policy include directory (provided by
.BR selinux\-policy\-devel ).
.SH SEE ALSO
.BR selinux (8),
.BR semodule (8),
.BR m4 (1),
.BR sesearch (1)
.SH AUTHOR
Pranav Lawate
